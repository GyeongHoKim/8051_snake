	ORG	8000H
DATAOUT	EQU	0FFF0H
DATAIN	EQU	0FFF1H
DLED	EQU	0FFC1H;7-SEGMENT RIGHT
ALED0	EQU	0FFC2H;7-SEGMENT MIDDLE
ALED1	EQU	0FFC3H;7-SEGMENT LEFT

LOOP:	CALL	SCANN
	JMP	LOOP;

SCANN:	PUSH	PSW
	SETB	PSW.4;USE BANK3 REGISTER
	SETB	PSW.3

INITIAL:
	MOV	R1,#00H
	MOV	A,#11101111B

COLSCAN:
	MOV	R0,A
	INC	R1
	CALL	SUBKEY
	ANL	A,#00011111B
	XRL	A,#00011111B
	JNZ	RSCAN
	MOV	A,R0
	SETB	C
	RRC	A
	JNC	INITIAL
	JMP	COLSCAN

RSCAN:	MOV	R2, #00H
ROWSCAN:
	RRC	A
	JC	MATRIX
	INC	R2
	JMP	ROWSCAN

MATRIX:	MOV	A,R2
	MOV	B,#05H
	MUL	AB
	ADD	A,R1
	CALL	INDEX
	CALL	DISPLAY
	POP	PSW
	RET

SUBKEY:	MOV	DPTR,#DATAOUT
	MOVX	@DPTR,A
	MOV	DPTR,#DATAIN
	MOVX	A,@DPTR
	RET

DISPLAY:
	MOV	DPTR,#DLED
	MOVX	@DPTR,A
	RET

RWKEY	EQU	10H
COMMA	EQU	11H
PERIOD	EQU	12H
GO	EQU	13H
REG	EQU	14H
CD	EQU	15H
INCR	EQU	16H
ST	EQU	17H
RST	EQU	18H

INDEX:	MOVC	A,@A+PC
	RET

KEYBASE:
	DB ST
	DB INCR
	DB CD
	DB REG
	DB GO
	DB 0CH
	DB 0DH
	DB 0EH
	DB 0FH
	DB COMMA
	DB 08H
	DB 09H
	DB 0AH
	DB 0BH
	DB PERIOD
	DB 04H
	DB 05H
	DB 06H
	DB 07H
	DB RWKEY
	DB 00H
	DB 01H
	DB 02H
	DB 03H
	END